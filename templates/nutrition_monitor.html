{% extends "base.html" %}

{% block title %}Nutrition Monitor - Personal Recipe Recommender{% endblock %}

{% block content %}
<div class="nutrition-monitor">
    <h2>ðŸ“Š Nutrition Monitor</h2>
    
    <!-- Period Toggle -->
    <div class="period-toggle">
        <a href="{{ url_for('nutrition_monitor', period='daily') }}" 
           class="btn {% if period == 'daily' %}active{% endif %}">Daily</a>
        <a href="{{ url_for('nutrition_monitor', period='monthly') }}" 
           class="btn {% if period == 'monthly' %}active{% endif %}">Monthly</a>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
        <div class="card">
            <h3>Total Meals</h3>
            <p class="number">{{ totals.meals }}</p>
            {% if period == 'monthly' %}
            <p class="average">Avg: {{ averages.meals|round(1) }} per day</p>
            {% endif %}
        </div>
        
        <div class="card">
            <h3>Calories</h3>
            <p class="number">{{ totals.calories|round }} kcal</p>
            {% if period == 'monthly' %}
            <p class="average">Avg: {{ averages.calories|round }} kcal/day</p>
            {% endif %}
            {% if period == 'daily' and progress.calories is not none %}
            <div class="progress-bar">
                <div class="progress" style="width: {{ (progress.calories|float|min(100))|string + '%' }}"></div>
                <span>{{ progress.calories|round }}% of goal</span>
            </div>
            {% endif %}
        </div>

        <div class="card">
            <h3>Protein</h3>
            <p class="number">{{ totals.protein|round(1) }}g</p>
            {% if period == 'monthly' %}
            <p class="average">Avg: {{ averages.protein|round(1) }}g/day</p>
            {% endif %}
            {% if period == 'daily' and progress.protein is not none %}
            <div class="progress-bar">
                <div class="progress" style="width: {{ (progress.protein|float|min(100))|string + '%' }}"></div>
                <span>{{ progress.protein|round }}% of goal</span>
            </div>
            {% endif %}
        </div>

        <div class="card">
            <h3>Fat</h3>
            <p class="number">{{ totals.fat|round(1) }}g</p>
            {% if period == 'monthly' %}
            <p class="average">Avg: {{ averages.fat|round(1) }}g/day</p>
            {% endif %}
            {% if period == 'daily' and progress.fat is not none %}
            <div class="progress-bar">
                <div class="progress" style="width: {{ (progress.fat|float|min(100))|string + '%' }}"></div>
                <span>{{ progress.fat|round }}% of goal</span>
            </div>
            {% endif %}
        </div>

        <div class="card">
            <h3>Carbs</h3>
            <p class="number">{{ totals.carbs|round(1) }}g</p>
            {% if period == 'monthly' %}
            <p class="average">Avg: {{ averages.carbs|round(1) }}g/day</p>
            {% endif %}
            {% if period == 'daily' and progress.carbs is not none %}
            <div class="progress-bar">
                <div class="progress" style="width: {{ (progress.carbs|float|min(100))|string + '%' }}"></div>
                <span>{{ progress.carbs|round }}% of goal</span>
            </div>
            {% endif %}
        </div>

        <div class="card">
            <h3>Fiber</h3>
            <p class="number">{{ totals.fiber|round(1) }}g</p>
            {% if period == 'monthly' %}
            <p class="average">Avg: {{ averages.fiber|round(1) }}g/day</p>
            {% endif %}
            {% if period == 'daily' and progress.fiber is not none %}
            <div class="progress-bar">
                <div class="progress" style="width: {{ (progress.fiber|float|min(100))|string + '%' }}"></div>
                <span>{{ progress.fiber|round }}% of goal</span>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Meal History -->
    <div class="meal-history">
        <h3>Meal History</h3>
        {% if nutrition_data %}
            <div class="meal-list">
                {% for meal in nutrition_data %}
                    <div class="meal-card">
                        <div class="meal-header">
                            <h4>{{ meal.recipe_name }}</h4>
                            <span class="meal-time">{{ meal.saved_at.strftime('%I:%M %p') }}</span>
                        </div>
                        <div class="meal-nutrition">
                            <p>Calories: {{ meal.calories|round }} kcal</p>
                            <p>Protein: {{ meal.protein|round(1) }}g</p>
                            <p>Fat: {{ meal.fat|round(1) }}g</p>
                            <p>Carbs: {{ meal.carbohydrates|round(1) }}g</p>
                            <p>Fiber: {{ meal.fiber|round(1) }}g</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-data">No meals recorded for this period.</p>
        {% endif %}
    </div>
</div>
{% endblock %} 